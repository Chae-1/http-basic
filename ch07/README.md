HTTP 헤더 (일반헤더)
==
## HTTP 헤더
- HTTP 전송에 필요한 모든 부가정보 담아서 전달한다.
- field-name : field-value 형태로 정보가 삽입된다.

### 헤더 분류
- General 헤더 : 메세지 전체에 적용되는 정보 
- Request 헤더 : 요청 정보.
- Response 헤더 : 응답 정보
- Entity 헤더 : 엔터티 바디 정보 즉, 본문의 정보

### HTTP BODY
Message Body라고도 부른다.
- 엔터티 본문을 전달하는데 사용한다.
  - 엔터티 본문 : 요청, 응답에서 실제 전달할 데이터
- 엔터티 헤더는 엔터티 본문을 해석할 수 있는 정보를 제공
  - 데이터 유형, 길이, 압축 정보

이제는 Entity라는 표현대신, Representation라 한다.
- Resprentation = 메타 데이터 + 데이터


### 표현 헤더(데이터에 관련된 메타데이터)
- Content-Type : 표현 데이터의 형식을 설명해준다.
  - 미디어 타입, 문자 인코딩을 나타낸다.
  - ex) application/json, image/png
- Content-Encoding : 표현 데이터의 압축 형식
  - 표현 데이터를 압축할 때 사용한다.
  - 데이터를 전달하는 쪽에서 압축 후 인코딩 헤더를 추가한다.
  - 데이터를 읽는 쪽에서는 인코딩 타입을 참고하여 압축을 해제한다.
- Content-Language : 표현 데이터의 자연 언어
  - 표현 데이터의 자연 언어를 나타낸다. 
  - ex) eng, ko ..
- Content-Length : 표현 데이터의 길이
  - 바이트 단위
  - Transfer-Encoding을 사용하면  Content-Length를 사용하지 않는다.
  


### 협상
클라이언트가 선호하는 표현 요청
- Accept : 클라이언트가 선호하는 미디어 타입 전달
- Accept-Charset: 클라이언트가 선호하는 문자 인코딩
- Accept-Encoding: 클라이언트가 선호하는 압축 인코딩
- Accept-Language: 클라이언트가 선호하는 자연 언어
위 헤더들은 요청할 때만 사용한다.

Accept-Language를 통해 다중 언어를 지원하는 서버에게 원하는 자연 언어를 요청할 수 있다.
- 만약 존재하지 않는 경우, 우선 순위를 정해 요청할 수 있다.
- ex) Accept-Language : ko-KR,ko;q=0.9,en-US;q=0.8
- ko를 지원하지 않는 서버라면 그 다음 우선 순위인 en-US를 반환한다.
- 구체적인 것이 우선 순위가 높다.
- 구체적인 것을 기준으로 미디어 타입을 맞춘다.


### 전송 방식
전송 방식은 크게 4가지 방식이 존재한다.
- 단순 전송
  - 한번에 쭉 전송 받을 수 있는 전송 방식.
  - Content-Length만 사용한다
- 압축 전송
  - 어떤 방식으로 압축했는지 클라이언트가 알아야한다.
  - Cotent-Encoding 을 통해 클라이언트에 알려주고 Cotent-Length로 사이즈를 알린다.
- 분할 전송
  - Transfer-Encoding을 사용한다.
  - 몇 바이트씩 분할해서 전송하는 방식이다.
  - 분할할 경우 Content-Length를 예상할 수 없기에 사용하지 않는다.
- 범위 전송
  - 클라이언트에서 Range를 통해 요청할 데이터의 범위를 지정할 수 있다.
  - 서버에서 Content-Range 를 통해 요청 받은 범위를 전송한다.


### 일반 정보
일반 정보는 정보성 헤더이다.
- From
  - 유저 에이전트의 이메일 정보
- Referer
  - 이전 웹 페이지의 주소정보를 나타낸다.
  - 이를 통해 유입경로를 파악할 수 있다.
  - 요청에서 사용한다.
- User-Agent
  - 유저 에이전트 어플리케이션 정보
  - 요청에서 사용한다.
  - 통계 정보, 장애 파악에 사용한다.
- Server
  - 요청을 처리하는 ORIGIN 서버의 소프트웨어 정보
  - 응답에서 사용한다.
  - ex) nginx, Apache/2.2.22
- Date
  - 메시지가 발생한 시간
  - 응답에서 사용한다.


### 특별 정보
- Host
  - 요청한 호스트 정보(도메인)
  - 요청에서 사용하며, 필수 값이다.
  - 하나의 서버가 여러 도메인을 처리해야 할 때
- Location
  - 리다이렉트를 위한 정보
  - 201 (Created) : 요청에 의해 생성된 리소스 URI
  - 3xx (Redirection) : 자동으로 리다이렉션을 휘한 리소스를 가르킨다.
- Allow
  - 허용 가능한 HTTP 메서드를 나타낸다.
- Retry-After
  - 유저 에이전트가 다음 요청을 하기까지 기다려야 하는 시간
  - 503 (Service Unavailable): 서비스가 언제까지 불능인지 알려줄 수 있다.

### 인증 헤더
- Authorization
  - 클라이언츠 인증 정보를 서버에 전달할 때 사용한다.
  - 인증 방식마다 넣어야하는 값이 다름
- WWW-Authenticate
  - 리소스 접근 시 필요한 인증 방법 정의

### 쿠키
- Set-Cookie: 서버에서 클라이언트로 쿠키 전달
- Cookie: 클라이언트가 서버에서 받은 쿠기를 저장하고, 요청시 서버로 전달

HTTP는 무상태 프로토콜이기때문에, 클라이언트에서 정보를 저장해야한다.

- 모든 요청에 사용자 정보를 포함하는 방법
  - URI에 모든 정보를 포함해야하는 것은 여러 문제가 생긴다.

이런 문제를 해결하기 위해 쿠키라는 개념이 등장했다.

쿠키는 
1. 클라이언트가 서버에서 응답받은 쿠기 정보를 저장한다.
2. 쿠키 저장소에서 조회한 후 모든 요청에 쿠키 값을 설정해 서버로 전송한다.

**사용처**
-사용자 로그인 세션 관리, 광고 정보 트래킹에 사용한다.

하지만, 보안에 민감한 데이터는 쿠키로 저장하면 안된다.

#### 생명주기 
- Set-Cookie: expires= Date
  - 만료일이 되면 쿠기가 삭제된다.
- Set-Cookie: max-age=3600
  - 0이나 음수를 지정하면 쿠키가 삭제된다.
- 세션 쿠키: 만료 날짜를 생략하면 브라우저 종료시 까지만 유지 
- 영속 쿠키: 만료 날짜를 입력하면 해당 날짜까지 유지

쿠키에 도메인, 경로를 지정할 수 있다.


#### 보안
- Secure
  - 쿠키는 http, https를 구분하지 않고 전송
  - Secure를 적용하면 https인 경우에만 전송
- HttpOnly
  - XSS 공격 방지
  - 자바스크립트에서 접근 불가능핟.
  - HTTP 전송에만 사용
- SameSite
  - XSRF 공격 방지
  - 요청 도메인과 쿠키에 설정된 도메인이 같은 경우만 쿠키 전송
