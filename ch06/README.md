HTTP 상태코드
==

## 상태 코드
**클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능**
- 1xx(Infomational) : 요청이 수신되어 처리중 -> 거의 사용안함
- 2xx(Successful) : 요청이 정상적으로 처리됐다.
- 3xx(Redirection) : 요청을 완료하기 위해, 추가적인 행동이 필요하다.
- 4xx(Client Error) : 클라이언트 오류, 클라이언트가 서버에 잘못 전송함.
- 5xx(Server Error) : 서버 오류, 서버가 정상적으로 처리하지 못함.

새로운 코드가 등장해도 앞의 1자리만 보고 판단할 수 있다.
- 240 -> (Successful)
- 451 -> (Client Error)

### 2xx - 성공
- 200 OK
- 201 Created
  - 요청 성공해서 새로운 리소스가 생성된다.
  - 이때, 클라이언트에 신규 리소스 URI에 대한 정보를 Location 헤더를 통해 전달한다.
- 202 Accepted
  - 요청이 접수됐으나 처리가 완료되지 않았다.
- 204 No Content
  - 서버가 요청을 성공적으로 수행했지만, 응답할 데이터가 없다.


### 3xx (Redirection)
요청을 완료하기 위해 유저 에이전트의 추가 조치가 필요하다.
- 300 Mutiple Choices
- 301 Moved Permanently
- 302 Found 
- 303 See Other
- 304 Not Modified
- 307 Temporary Redirect
- 308 Permanent Redirect

웹 브라우저는 3xx 응답 결과에 Location 헤더가 있으면 그 위치로 자동 이동하는 데 이를 `리다이렉트`라 한다.

#### 리다이렉션의 종류
- **영구 리다이렉션** 
  - 특정 리소스의 URI가 영구적으로 이동
  - /members -> /users, /event -> /new-event
  - 대표적으로 301, 308이 존재한다.
  - 301 Moved Permanently
    - 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있다.
  - 308 Permanent Redirect
    - 301과 기능은 같다.
    - 리다이렉트시 요청 메서드와 본문을 유지한다.
    - 즉, 이전 메세지 바디를 그대로 전송한다.
  
- **일시 리다이렉션** - 리소스의 URI가 일시적으로 변경
  - 대표적으로 302, 307, 303이 존재한다.
  - **302 Found** 
    - 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있다.
  - **307 Temporary Redirect** 
    - 302와 기능은 같다.
    - 리다이렉트시 요청 메서드와 본문 유지(요청 메서드를 변경하면 안된다.)
  - **303 See Other**
    - 302와 기능은 같다.
    - 리다이렉트시 요청 메서드가 GET으로 변경된다.

일시적 리다이렉션이 반드시 필요한 경우가 존재한다.

**PRG:Post/Redirect/Get**
- POST로 주문후에 웹 브라우저를 새로고침하면?
  - 별도의 처리를 하지 않으면 POST 요청이 된다.
  - 동일 결제가 2번 일어날 수도 있다는 것이다.

이 문제를 해결하기 위해 PRG 패턴을 사용한다.
- POST 이후, 결과를 GET 메서드로 리다이렉트하면 새로고침해도 GET으로 조회한다.
- 중복 요청 대신, 결과만 GET으로 다시 요청하게 된다.

1. POST로 서버에 요청을 한다.
2. 서버는 이를 DB에 저장하고 응답을 내린다.
3. 응답은 200 OK가 아닌, 리다이렉트 코드를 보낸다.
4. Location 헤더로 리소스를 제공한다.
5. 클라이언트는 Location 헤더의 리소스로 GET요청을 보낸다.
6. 이후 새로고침을 해도 GET 요청을 보내 동일 POST 요청을 전송하지 않게된다.


### 302, 307, 303 정리
- 302 Found -> GET으로 변할 수 있음
- 307 Temporary Redirect -> 메서드가 변하면 안된다.
- 303 See Other -> 메서드가 GET으로 변경

307, 303을 사용하는 것을 권장하지만, 자동 리다이렉션시 GET으로 변해도 상관없다면 302를 사용해도 큰 문제가 없다.


### 기타 리다이렉션 
- 300 Mutiple Choices -> 안쓴다.
- 304 Not Modified
  - 캐시를 목적으로 사용한다.
  - 조건부 GET, HEAD 요청시 사용
  - 클라이언트에게 리소스가 수정되지 않았음을 알려준다. 따라서 로컬 PC에 저장된 캐시를 재사용한다.
  

### 4xx
클라이언트 오류 
- 클라이언트의 요렁에 잘못된 문법등으로 서버가 요청을 수행할 수 없음.
- **오류의 원인이 클라이언트에 있다.**
- 클라이언트가 잘못된 데이터를 보내거나, 요청을 보내고 있기 때문에 똑같은 재시도가 일어난다.

#### 400 Bad Request
클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음
- 클라이언트가 요청 내용을 검토하고, 보내야 한다는 것을 알려준다.
- API 스펙이 맞지 않거나, 요청 파라미터가 잘못됐을 경우가 존재한다.


#### 401 Unauthorized
클라이언트가 해당 리소스에 대한 인증이 필요함.
- 인증되지 않았다는 것을 알려준다.
  - 인증(Authentication) - 본인이 누구인지 확인(로그인)
  - 인가(Authorization) - 인증받은 유저가 리소스에 접근하기 위한 권한.

### 403 Forbidden
서버가 요청을 이해했지만, 승인을 거부함
- 주로 인증은 했지만, 접근 권한이 충분하지 않을때 사용한다.

### 404 Not Found
요청 리소스를 찾을 수 없을때 사용
- 권한이 부족한 클라이언트가 리소스에 접근하고자 할 때, 이를 숨기고자 사용하기도 한다.


### 5xx
서버 오류
- 서버 문제로 오류 발생
- 서버에 문제가 있기 때문에 재시도 하면 성공할 수도 있다. 


#### 500 (Internal Server Error)
서버 내부의 오류

#### 503 (Service Unavailable)
서비스 이용 불가

